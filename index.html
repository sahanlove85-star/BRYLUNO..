<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRYLUNO | Ultimate Business Ecosystem</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&display=swap');
        
        :root { --p-color: #512da8; --s-color: #ffca28; --dark: #0f172a; }
        body { font-family: 'Outfit', sans-serif; background: #f1f5f9; scroll-behavior: smooth; }

        /* UI Enhancements */
        .glass-nav { background: rgba(81, 45, 168, 0.95); backdrop-filter: blur(10px); }
        .sidebar { transform: translateX(-100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; }
        .sidebar.active { transform: translateX(0); }
        
        .page { display: none; min-height: 100vh; padding-bottom: 100px; }
        .page.active { display: block; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .product-card { background: white; border-radius: 20px; transition: 0.3s; border: 1px solid #e2e8f0; position: relative; overflow: hidden; }
        .product-card:hover { transform: scale(1.02); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        .btn-gold { background: var(--s-color); color: var(--dark); font-weight: 800; border-radius: 12px; transition: 0.3s; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 10px 15px rgba(255, 202, 40, 0.4); }

        .admin-badge { background: #ef4444; color: white; padding: 2px 8px; border-radius: 5px; font-size: 10px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="overlay" class="fixed inset-0 bg-black/50 hidden z-[1500]" onclick="toggleSidebar()"></div>
    <aside id="sidebar" class="sidebar fixed top-0 left-0 w-80 h-full bg-white shadow-2xl p-6">
        <div class="flex justify-between items-center mb-10 border-b pb-4">
            <h2 class="text-2xl font-black text-purple-900 tracking-tighter italic">BRYLUNO MENU</h2>
            <i class="fa-solid fa-circle-xmark text-2xl text-gray-400 cursor-pointer" onclick="toggleSidebar()"></i>
        </div>
        <nav class="space-y-4">
            <div onclick="showPage('home')" class="flex items-center gap-4 p-3 hover:bg-purple-50 rounded-xl cursor-pointer text-gray-700 font-bold"><i class="fa-solid fa-house-chimney w-6 text-purple-600"></i> Home Feed</div>
            <div onclick="showPage('categories')" class="flex items-center gap-4 p-3 hover:bg-purple-50 rounded-xl cursor-pointer text-gray-700 font-bold"><i class="fa-solid fa-layer-group w-6 text-purple-600"></i> Categories</div>
            <div onclick="showPage('reseller-hub')" class="flex items-center gap-4 p-3 hover:bg-purple-50 rounded-xl cursor-pointer text-gray-700 font-bold"><i class="fa-solid fa-handshake-angle w-6 text-purple-600"></i> Partner Portal</div>
            <hr>
            <div id="admin-only-link" class="hidden" onclick="showPage('admin-panel')">
                <div class="flex items-center gap-4 p-3 bg-red-50 text-red-600 rounded-xl cursor-pointer font-black"><i class="fa-solid fa-shield-halved w-6"></i> MASTER CONSOLE</div>
            </div>
            <div onclick="showPage('account')" class="flex items-center gap-4 p-3 hover:bg-purple-50 rounded-xl cursor-pointer text-gray-700 font-bold"><i class="fa-solid fa-user-gear w-6 text-purple-600"></i> Settings</div>
        </nav>
        <div class="absolute bottom-10 left-6 right-6">
            <button onclick="logout()" class="w-full p-4 bg-gray-100 text-red-500 rounded-2xl font-black">LOGOUT SYSTEM</button>
        </div>
    </aside>

    <header class="glass-nav sticky top-0 z-[1000] text-white">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div onclick="toggleSidebar()" class="w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-white/10 rounded-full">
                    <i class="fa-solid fa-bars-staggered text-xl"></i>
                </div>
                <h1 class="text-2xl font-black italic tracking-tighter">BRYLUNO</h1>
            </div>
            <div class="flex items-center gap-5">
                <div class="relative cursor-pointer" onclick="showPage('cart')">
                    <i class="fa-solid fa-cart-flatbed-suitcase text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-yellow-400 text-black text-[10px] font-black px-1.5 rounded-full">0</span>
                </div>
                <div onclick="showPage('auth')" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center cursor-pointer">
                    <i class="fa-solid fa-user-lock"></i>
                </div>
            </div>
        </div>
        <div class="px-4 pb-4 max-w-3xl mx-auto">
            <div class="relative group">
                <input type="text" id="masterSearch" onkeyup="dynamicSearch()" placeholder="Search Products, Resellers, Orders..." class="w-full bg-white/10 border border-white/20 py-3 px-12 rounded-2xl text-white placeholder:text-white/60 outline-none focus:bg-white focus:text-black transition-all">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-4 text-white/50 group-focus-within:text-purple-600"></i>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto">
        
        <section id="home" class="page active px-4 pt-6">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-black text-gray-800 uppercase italic">Trending Drops</h2>
                <span class="text-xs font-bold text-purple-600 cursor-pointer">View All <i class="fa-solid fa-arrow-right"></i></span>
            </div>
            <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                </div>
        </section>

        <section id="admin-panel" class="page px-4 pt-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white p-8 rounded-[30px] shadow-sm border">
                    <h3 class="text-xl font-black mb-6 uppercase flex items-center gap-3"><i class="fa-solid fa-upload text-purple-600"></i> Asset Deployment</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="p-name" placeholder="Product Title" class="p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 ring-purple-400">
                        <input type="number" id="p-price" placeholder="Global Price (LKR)" class="p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 ring-purple-400">
                        <select id="p-cat" class="p-4 bg-gray-50 border rounded-2xl outline-none">
                            <option>Cake Shop</option>
                            <option>Combo Packs</option>
                            <option>Clothing</option>
                        </select>
                        <input type="file" id="p-file" class="p-4 border-2 border-dashed rounded-2xl">
                    </div>
                    <button onclick="masterUpload()" id="upBtn" class="w-full mt-6 bg-purple-900 text-white py-5 rounded-2xl font-black tracking-widest uppercase hover:bg-black transition">Deploy to Live Network</button>
                </div>
                <div class="bg-black text-white p-8 rounded-[30px] flex flex-col justify-between">
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Network Revenue</p>
                        <h4 class="text-4xl font-black italic">LKR <span id="total-rev">0.00</span></h4>
                    </div>
                    <div class="mt-10 space-y-4">
                        <div class="flex justify-between text-sm border-b border-white/10 pb-2"><span>Resellers</span><span id="reseller-count">0</span></div>
                        <div class="flex justify-between text-sm border-b border-white/10 pb-2"><span>Pending Approvals</span><span class="text-yellow-400">5</span></div>
                    </div>
                </div>
            </div>
            <div class="mt-10 bg-white p-6 rounded-3xl border">
                <h3 class="font-bold mb-4">Live Inventory Control</h3>
                <div id="admin-list" class="space-y-3"></div>
            </div>
        </section>

        <section id="auth" class="page px-4 pt-10">
            <div class="max-w-md mx-auto bg-white p-10 rounded-[40px] shadow-2xl border text-center">
                <div class="w-20 h-20 bg-purple-100 text-purple-600 rounded-3xl flex items-center justify-center mx-auto mb-6 text-3xl">
                    <i class="fa-solid fa-fingerprint"></i>
                </div>
                <h2 class="text-2xl font-black mb-8 uppercase tracking-tighter">Bryluno ID</h2>
                <div class="space-y-4 text-left">
                    <input type="email" id="auth-email" placeholder="Email" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none">
                    <input type="password" id="auth-pass" placeholder="Password" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none">
                    <button onclick="handleLogin()" class="w-full bg-purple-900 text-white py-4 rounded-2xl font-black">SIGN IN</button>
                    <button onclick="showPage('reseller-reg')" class="w-full border-2 border-purple-900 text-purple-900 py-4 rounded-2xl font-black mt-2">BECOME A PARTNER</button>
                </div>
            </div>
        </section>

        <section id="reseller-reg" class="page px-4 pt-10">
            <div class="max-w-2xl mx-auto bg-white p-10 rounded-[40px] shadow-sm border">
                <h2 class="text-2xl font-black mb-2 italic">Partner Application</h2>
                <p class="text-gray-400 text-sm mb-8">Registration Fee: Rs. 500 | Commission: Up to Rs. 1500</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="reg-name" placeholder="Full Name" class="p-4 border rounded-2xl outline-none bg-gray-50">
                    <input type="text" id="reg-wa" placeholder="WhatsApp Number" class="p-4 border rounded-2xl outline-none bg-gray-50">
                    <input type="email" id="reg-email" placeholder="Email" class="p-4 border rounded-2xl outline-none bg-gray-50 col-span-full">
                    <input type="text" id="reg-ss" placeholder="Payment Screenshot Link" class="p-4 border rounded-2xl outline-none bg-gray-50 col-span-full">
                </div>
                <button onclick="submitPartner()" class="w-full mt-6 bg-amber-500 text-black py-5 rounded-2xl font-black uppercase italic">Submit Application</button>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-white/80 backdrop-blur-xl border border-white/20 h-20 rounded-full shadow-2xl flex justify-around items-center px-6 z-[1000]">
        <button onclick="showPage('home')" class="text-purple-900 text-xl"><i class="fa-solid fa-house"></i></button>
        <button onclick="showPage('categories')" class="text-gray-400 text-xl"><i class="fa-solid fa-magnifying-glass"></i></button>
        <button onclick="showPage('admin-panel')" id="dock-admin" class="hidden text-red-500 text-xl"><i class="fa-solid fa-gauge-high"></i></button>
        <button onclick="showPage('auth')" class="text-gray-400 text-xl"><i class="fa-solid fa-user-astronaut"></i></button>
    </nav>

    <script>
        // CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyAoYDclGhL75b14C1fT_5SRsrrEt8B6iyU",
            authDomain: "bryluno-system.firebaseapp.com",
            databaseURL: "https://bryluno-system-default-rtdb.firebaseio.com",
            projectId: "bryluno-system",
            storageBucket: "bryluno-system.firebasestorage.app",
            messagingSenderId: "666741527124",
            appId: "1:666741527124:web:bebf8a61c085eba11cd3c1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Cloudinary Config
        const CLOUD_URL = "https://api.cloudinary.com/v1_1/djsrfrxcu/image/upload";
        const CLOUD_PRESET = "bryluno-products";

        // UI CONTROLS
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (window.innerWidth < 768) toggleSidebar();
            window.scrollTo(0,0);
        }

        // ASSET DEPLOYMENT (CLOUDINARY + FIREBASE)
        async function masterUpload() {
            const file = document.getElementById('p-file').files[0];
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const cat = document.getElementById('p-cat').value;
            const btn = document.getElementById('upBtn');

            if(!file || !name || !price) {
                return Swal.fire("Error", "All data modules required!", "error");
            }

            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-spinner animate-spin"></i> SYNCING TO CLOUD...`;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUD_PRESET);

            try {
                // 1. Cloudinary Upload
                const res = await fetch(CLOUD_URL, { method: 'POST', body: formData });
                const cloudData = await res.json();

                // 2. Firebase Sync
                await db.ref('inventory').push({
                    name, price, cat, img: cloudData.secure_url, time: Date.now()
                });

                Swal.fire("Success", "Asset Deployed to Global Network", "success");
                btn.disabled = false;
                btn.innerText = "Deploy to Live Network";
                location.reload();
            } catch (e) {
                Swal.fire("System Error", e.message, "error");
                btn.disabled = false;
            }
        }

        // REAL-TIME DATA LOAD
        function initSystem() {
            db.ref('inventory').on('value', snap => {
                const grid = document.getElementById('product-grid');
                const adminList = document.getElementById('admin-list');
                grid.innerHTML = '';
                adminList.innerHTML = '';

                snap.forEach(child => {
                    const p = child.val();
                    const key = child.key;

                    // Shop Card
                    grid.innerHTML += `
                        <div class="product-card group">
                            <img src="${p.img}" class="w-full h-56 object-cover rounded-t-2xl">
                            <div class="p-5">
                                <p class="text-[10px] font-black text-purple-600 uppercase mb-1">${p.cat}</p>
                                <h3 class="font-bold text-gray-800 text-sm mb-3 h-10 overflow-hidden">${p.name}</h3>
                                <div class="flex justify-between items-center">
                                    <p class="font-black text-purple-900">LKR ${Number(p.price).toLocaleString()}</p>
                                    <button onclick="reserveItem('${p.name}', ${p.price})" class="btn-gold px-4 py-2 text-[10px]">ORDER</button>
                                </div>
                            </div>
                        </div>
                    `;

                    // Admin Management Row
                    adminList.innerHTML += `
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl border">
                            <div class="flex items-center gap-4">
                                <img src="${p.img}" class="w-12 h-12 rounded-lg object-cover">
                                <div>
                                    <p class="font-bold text-sm">${p.name}</p>
                                    <p class="text-xs text-gray-400">LKR ${p.price}</p>
                                </div>
                            </div>
                            <button onclick="deleteAsset('${key}')" class="text-red-500 font-black text-xs hover:bg-red-50 px-4 py-2 rounded-xl">REMOVE</button>
                        </div>
                    `;
                });
            });
        }

        // SEARCH ENGINE (DYNAMIC)
        function dynamicSearch() {
            let filter = document.getElementById('masterSearch').value.toUpperCase();
            let cards = document.getElementsByClassName('product-card');
            for (let i = 0; i < cards.length; i++) {
                let name = cards[i].getElementsByTagName('h3')[0].innerText;
                cards[i].style.display = name.toUpperCase().includes(filter) ? "" : "none";
            }
        }

        // ORDER GENERATOR (AUTO-INVOICE)
        function reserveItem(name, price) {
            const invoice = `*BRYLUNO ORDER INVOICE*%0A--------------------------%0A*Product:* ${name}%0A*Price:* LKR ${price}%0A*Status:* Pending Verification%0A--------------------------%0A_Please send your payment screenshot._`;
            window.open(`https://wa.me/94752351754?text=${invoice}`, '_blank');
        }

        function deleteAsset(key) {
            Swal.fire({
                title: 'Delete Asset?',
                text: "This cannot be undone!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Yes, Delete!'
            }).then((result) => {
                if (result.isConfirmed) db.ref('inventory').child(key).remove();
            });
        }

        // AUTH & ROLES
        async function handleLogin() {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            try {
                await auth.signInWithEmailAndPassword(email, pass);
                if (email === "bryluno.pvt.ltd@gmail.com") {
                    document.getElementById('admin-only-link').classList.remove('hidden');
                    document.getElementById('dock-admin').classList.remove('hidden');
                    showPage('admin-panel');
                } else {
                    showPage('home');
                }
            } catch (e) { Swal.fire("Login Failed", e.message, "error"); }
        }

        window.onload = initSystem;
    </script>
</body>
</html>
