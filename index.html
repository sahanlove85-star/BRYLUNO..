<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRYLUNO | Premium Enterprise System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f4f4f9; }
        .kap-purple { background-color: #512da8; }
        .kap-yellow { background-color: #ffca28; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .product-card { background: white; border-radius: 8px; border: 1px solid #e2e8f0; transition: 0.3s; overflow: hidden; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-20">

    <header class="kap-purple text-white sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-4">
                    <i class="fa-solid fa-bars text-xl cursor-pointer"></i>
                    <h1 class="text-2xl font-black italic">BRYLUNO</h1>
                </div>
                <div class="flex items-center gap-5">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <i onclick="showPage('admin-login')" class="fa-solid fa-circle-user text-xl cursor-pointer"></i>
                </div>
            </div>
            <div class="relative max-w-2xl mx-auto">
                <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="Type here..." class="w-full py-2 px-4 pr-12 rounded text-gray-800 outline-none">
                <button class="absolute right-0 top-0 h-full px-4 kap-yellow rounded-r text-gray-800">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4">
        
        <section id="home" class="page active">
            <div class="flex gap-3 overflow-x-auto no-scrollbar py-4 mb-4 text-[11px] font-bold uppercase whitespace-nowrap">
                <span class="bg-white border px-4 py-2 rounded shadow-sm">All Gifts</span>
                <span class="bg-white border px-4 py-2 rounded">Cakes</span>
                <span class="bg-white border px-4 py-2 rounded">Chocolates</span>
                <span class="bg-white border px-4 py-2 rounded">Flowers</span>
            </div>

            <div id="product-list" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
                </div>
        </section>

        <section id="admin-login" class="page mt-10">
            <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg border">
                <h2 class="text-xl font-bold mb-6 text-center">Admin Secure Access</h2>
                <input type="email" id="adm-email" placeholder="Email" class="w-full p-3 border rounded mb-4 outline-none">
                <input type="password" id="adm-pass" placeholder="Password" class="w-full p-3 border rounded mb-6 outline-none">
                <button onclick="handleLogin()" class="w-full kap-purple text-white py-3 rounded font-bold">LOGIN</button>
            </div>
        </section>

        <section id="dashboard" class="page mt-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
                <h2 class="font-bold text-lg mb-4 flex items-center gap-2"><i class="fa-solid fa-cloud-arrow-up text-purple-600"></i> Upload New Product</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="p-name" placeholder="Product Name" class="p-3 border rounded outline-none">
                    <input type="number" id="p-price" placeholder="Price (LKR)" class="p-3 border rounded outline-none">
                    <input type="file" id="p-file" class="p-2 border rounded bg-gray-50">
                    <button onclick="uploadToCloudinary()" id="up-btn" class="kap-purple text-white font-bold py-3 rounded">PUBLISH PRODUCT</button>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl border">
                <h3 class="font-bold mb-4">Live Inventory Control</h3>
                <div id="admin-inventory" class="space-y-3 text-sm">
                    </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 w-full bg-white border-t flex justify-around py-3 shadow-2xl">
        <button onclick="showPage('home')" class="text-purple-900"><i class="fa-solid fa-house text-lg"></i></button>
        <button onclick="showPage('admin-login')"><i class="fa-solid fa-users text-lg text-gray-400"></i></button>
        <button onclick="showPage('dashboard')"><i class="fa-solid fa-chart-line text-lg text-gray-400"></i></button>
    </nav>

    <script>
        // 1. CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyAoYDclGhL75b14C1fT_5SRsrrEt8B6iyU",
            authDomain: "bryluno-system.firebaseapp.com",
            databaseURL: "https://bryluno-system-default-rtdb.firebaseio.com",
            projectId: "bryluno-system"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Cloudinary Details
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/djsrfrxcu/image/upload";
        const CLOUDINARY_PRESET = "bryluno-products"; // <--- உங்கள் Upload Preset பெயரை இங்கே மாற்றவும்!

        // 2. UI NAVIGATION
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // 3. CLOUDINARY UPLOAD & FIREBASE SAVE
        async function uploadToCloudinary() {
            const file = document.getElementById('p-file').files[0];
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const btn = document.getElementById('up-btn');

            if (!file || !name || !price) return alert("All fields are required!");

            btn.disabled = true;
            btn.innerText = "Uploading to Cloudinary...";

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_PRESET);

            try {
                // Upload to Cloudinary
                const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
                const data = await res.json();
                const imgURL = data.secure_url;

                // Save to Firebase
                await db.ref('inventory').push({
                    name: name,
                    price: price,
                    img: imgURL,
                    timestamp: Date.now()
                });

                alert("Product Published!");
                location.reload();
            } catch (err) {
                alert("Upload Failed: " + err.message);
                btn.disabled = false;
                btn.innerText = "PUBLISH PRODUCT";
            }
        }

        // 4. LOAD PRODUCTS
        function loadData() {
            db.ref('inventory').on('value', snap => {
                const grid = document.getElementById('product-list');
                const adminList = document.getElementById('admin-inventory');
                grid.innerHTML = '';
                adminList.innerHTML = '';

                snap.forEach(child => {
                    const p = child.val();
                    const key = child.key;

                    // Frontend Card
                    grid.innerHTML += `
                        <div class="product-card flex flex-col">
                            <div class="h-44 bg-gray-100 relative">
                                <img src="${p.img}" class="w-full h-full object-cover">
                                <span class="absolute top-2 left-2 bg-yellow-400 text-[9px] font-bold px-2 py-0.5 rounded">Top Choice</span>
                            </div>
                            <div class="p-3 flex-1 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-[13px] text-gray-700 font-medium mb-1 h-10 overflow-hidden leading-tight">${p.name}</h3>
                                    <p class="text-purple-900 font-bold text-sm">RS. ${Number(p.price).toLocaleString()}</p>
                                </div>
                                <button onclick="reserve('${p.name}')" class="w-full mt-3 border border-purple-800 text-purple-800 py-1.5 rounded text-[10px] font-bold hover:bg-purple-800 hover:text-white transition">RESERVE</button>
                            </div>
                        </div>
                    `;

                    // Admin Management Row
                    adminList.innerHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded border">
                            <span>${p.name} (RS ${p.price})</span>
                            <button onclick="deleteProduct('${key}')" class="text-red-500 font-bold">DELETE</button>
                        </div>
                    `;
                });
            });
        }

        // 5. SEARCH LOGIC
        function searchProducts() {
            let filter = document.getElementById('searchInput').value.toUpperCase();
            let cards = document.getElementsByClassName('product-card');
            for (let i = 0; i < cards.length; i++) {
                let title = cards[i].getElementsByTagName('h3')[0];
                if (title.innerText.toUpperCase().indexOf(filter) > -1) {
                    cards[i].style.display = "";
                } else {
                    cards[i].style.display = "none";
                }
            }
        }

        function reserve(name) {
            window.open(`https://wa.me/94752351754?text=I want to buy: ${name}`, '_blank');
        }

        function deleteProduct(key) {
            if(confirm("Are you sure?")) db.ref('inventory').child(key).remove();
        }

        async function handleLogin() {
            try {
                await auth.signInWithEmailAndPassword(document.getElementById('adm-email').value, document.getElementById('adm-pass').value);
                showPage('dashboard');
            } catch(e) { alert("Access Denied"); }
        }

        window.onload = loadData;
    </script>
</body>
    </html>
